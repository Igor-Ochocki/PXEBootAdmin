#!/bin/sh
# get-station-symlink - Get the system code for a station
# ochockii 2025

# Constants
OPT_DIR="/opt/stations"

# Function to print colored output
print_status() {
  echo -e "\033[1;32m[STATUS]\033[0m $1"
}

print_error() {
  echo -e "\033[1;31m[ERROR]\033[0m $1"
}

usage() {
  echo "Usage: $0 <stationId>"
  echo "Example: $0 station1"
  exit 1
}

[ "$(id -u)" -eq 0 ] || { print_error "This script must be run as root"; exit 1; }

[ $# -eq 1 ] || { print_error "Missing required argument"; usage; }

STATION_ID=$1                       # Station ID in format "s{x}"
TARGET_DIR="$OPT_DIR/$STATION_ID"   # Target directory for the symlink

[ -L "$TARGET_DIR" ] || { print_error "Station directory $TARGET_DIR does not exist"; exit 1; }

LINK_TARGET=$(readlink -f "$TARGET_DIR") || { print_error "Failed to read symlink"; exit 1; }

SYSTEM_CODE=$(basename "$LINK_TARGET")
echo "$SYSTEM_CODE"

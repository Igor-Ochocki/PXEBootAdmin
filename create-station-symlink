#!/bin/sh
# create-station-symlink - Create a symlink for a station
# ochockii 2025

OPT_DIR="/opt/stations"

print_status() {
  echo -e "\033[1;32m[STATUS]\033[0m $1"
}

print_error() {
  echo -e "\033[1;31m[ERROR]\033[0m $1"
}

usage() {
  echo "Usage: $0 <stationId> <systemCode>"
  echo "Example: $0 station1 linux-ubuntu"
  exit 1
}

[ "$(id -u)" -eq 0 ] || { print_error "This script must be run as root"; exit 1; }

[ $# -eq 2 ] || { print_error "Missing required arguments"; usage; }

STATION_ID=$1
SYSTEM_CODE=$2
TARGET_DIR="$OPT_DIR/$STATION_ID"
LINK_NAME="$SYSTEM_CODE"

[ -d "$OPT_DIR" ] || { mkdir -pv "$OPT_DIR"; }

ln -sv -f "$LINK_NAME" "$TARGET_DIR" || { print_error "Failed to create symlink"; exit 1; }

print_status "Symlink created successfully:"
ls -l "$TARGET_DIR"

exit 0